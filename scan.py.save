#!/usr/bin/env python3
from bluepy.btle import Scanner
from operator import itemgetter
 
scanner = Scanner()
devices = scanner.scan(1.5)
#print(devices) 

list = []

for device in devices:
    print("DEV = {} RSSI = {}".format(device.addr, device.rssi))
    list.append((device.addr.encode("ascii"), device.rssi))

#print(list)

nearestDevs = sorted(list, key=itemgetter(1), reverse=True)
print(nearestDevs)

map = {
    "7f:3f:d1:b1:f1:0a": "fette AMG",
    "39:b1:cf:55:44:de": "history section",
    "d0:03:df:86:c9:d5": "dunno man"
 }

nearestKnown = "undetermined"
for dev in nearestDevs:
    print(map.get(dev[0]))
    if map.get(dev[0]) is not None:
        nearestKnown = dev
        break

print("My nearest known beacon is: "+str(nearestKnown[0])+" with strength: "+str(nearestKnown[1])+" located: "+str(map.get(nearestKnown[0])))
print("I'm probably here: "+str(map.get(nearestDevs[0][0])))




import os

os.system('sudo -u pi ssh ubuntu@zaphod.vsos.ethz.ch "echo '+str(map.get(nearestKnown[0]))+' > /home/ubuntu/api/rpi"')
